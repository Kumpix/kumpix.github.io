<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Horeca Finansal Analiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .card {
            background-color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        input[type="number"],
        select {
            font-size: 16px !important;
        }

        /* Artırma/Azaltma tuşlarını gizle */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            border-bottom: 1px dashed #e5e7eb;
        }

        /* Make the label flexible and force the amount to stay right-aligned */
        .report-item>span:first-child {
            flex: 1 1 auto;
            margin-right: 0.5rem;
            text-align: left;
        }

        .report-item>span:last-child {
            flex: 0 0 auto;
            min-width: 8rem;
            display: inline-block;
            text-align: right;
        }

        .report-total {
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
        }

        .benchmark-item {
            font-size: 0.7rem;
            color: #9ca3af;
            text-align: right;
            margin-top: 0.15rem;
            /* Ensure benchmark text sticks to the right even when the amount becomes bold */
            display: flex;
            justify-content: flex-end;
            /* align-items: center; */
        }

        .annual-revenue-line {
            font-size: 0.7rem;
            color: #9ca3af;
            text-align: left;
            margin-top: 0.25rem;
            padding-top: 0.25rem;
            border-top: 1px solid #e5e7eb;
        }

        /* Ortaklık Accordion */
        .accordion-header {
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f3e8ff;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .accordion-header:hover {
            background: #e9d5ff;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .accordion-content.active {
            max-height: 2000px;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-icon.active {
            transform: rotate(180deg);
        }

        .accordion-icon-valuation {
            transition: transform 0.3s ease;
        }

        .accordion-icon-valuation.active {
            transform: rotate(180deg);
        }

        /* Ortak Renkleri */
        .partner-1 {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }

        .partner-2 {
            background-color: #fce7f3;
            border-color: #ec4899;
        }

        .partner-3 {
            background-color: #d1fae5;
            border-color: #10b981;
        }

        .partner-4 {
            background-color: #fed7aa;
            border-color: #f59e0b;
        }

        /* Modal Stilleri */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* DCF Tablo */
        .dcf-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.75rem;
        }

        .dcf-table th,
        .dcf-table td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .dcf-table th {
            background-color: #fef3c7;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .dcf-table td {
            font-size: 0.875rem;
        }

        .toggle-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: #6366f1;
            background-color: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 0.5rem;
        }

        .toggle-btn:hover {
            background-color: #e0e7ff;
        }

        /* Mobil Uyumluluk */
        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
            }

            .card {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
            }

            .input-group {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .input-group>div {
                width: 100%;
                display: flex;
                justify-content: space-between;
                gap: 0.75rem;
            }

            .input-group input[type="text"],
            .input-group select {
                width: 100% !important;
                padding: 0.5rem !important;
            }

            .text-3xl {
                font-size: 1.5rem;
            }

            .text-2xl {
                font-size: 1.125rem;
            }

            .text-xl {
                font-size: 1rem;
            }

            .modal-content {
                padding: 1rem;
                max-height: 85vh;
            }

            button {
                touch-action: manipulation;
                padding: 0.625rem 1rem !important;
                font-size: 0.875rem;
            }

            .dcf-table th,
            .dcf-table td {
                padding: 0.35rem;
                font-size: 0.75rem;
            }

            h1 {
                margin-bottom: 0.5rem !important;
            }

            h2 {
                margin-bottom: 0.5rem !important;
            }

            .space-y-6>*+* {
                margin-top: 0.75rem !important;
            }
        }

        /* iOS Safari özel düzeltmeler */
        @supports (-webkit-touch-callout: none) {
            input[type="text"] {
                -webkit-appearance: none;
                appearance: none;
            }
        }
    </style>
</head>

<body class="p-4">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2 text-center">
            Horeca Finansal Analiz
        </h1>
        <p class="text-center text-gray-600 mb-4 text-sm sm:text-base">
            Günlük ciro ve giderlerinizi girerek aylık/yıllık kâr marjınızı hesaplayın ve işletmenizin muhtemel değerini
            tahmin edin.
        </p>

        <!-- Aksiyon Butonları -->
        <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4 mb-4">
            <button onclick="generateAndShowReport();"
                class="flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-200">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                </svg>
                Özet Rapor Paylaş
            </button>
            <button onclick="clearInputs();"
                class="flex items-center justify-center bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-200">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
                Girdileri Sıfırla
            </button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">

            <!-- CİRO VE GİDER GİRİŞİ -->
            <div class="lg:col-span-2 card">
                <h2 class="text-xl sm:text-2xl font-semibold text-blue-700 mb-3 border-b pb-2">1. Gelir & Gider
                    Girişleri</h2>

                <!-- Günlük Ciro - Üç Bölüm -->
                <div class="mb-4">
                    <h3 class="text-base font-medium text-gray-800 mb-2">Günlük Ortalama Ciro (€)</h3>

                    <div class="space-y-2">
                        <div>
                            <label for="cashRevenue" class="block text-sm font-medium text-gray-700 mb-1">1. Nakit
                                Gelirler (€)</label>
                            <input type="text" inputmode="decimal" id="cashRevenue" value="0"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                        </div>

                        <div>
                            <label for="cardRevenue" class="block text-sm font-medium text-gray-700 mb-1">2. Peşin
                                Ödemeler (€)</label>
                            <input type="text" inputmode="decimal" id="cardRevenue" value="0"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                        </div>

                        <div>
                            <label for="deliveryRevenue" class="block text-sm font-medium text-gray-700 mb-1">3. Evlere
                                Servis (€)</label>
                            <input type="text" inputmode="decimal" id="deliveryRevenue" value="0"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 mb-1">

                            <label for="deliveryCommission"
                                class="block text-xs font-medium text-gray-600 mb-1">Ortalama Gider Oranı (%) - Komisyon
                                vb.</label>
                            <input type="text" inputmode="decimal" id="deliveryCommission" value="0"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 transition duration-150">
                            <p class="text-xs text-gray-500 mt-1">Bu giderin %80'i personel, %20'si gıda maliyetine
                                eklenecektir.</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <h3 class="text-base font-medium text-gray-800 border-b pb-1">Temel Gider Kalemleri</h3>
                    <div id="expense-container"></div>
                </div>
            </div>

            <!-- GELİR TAHMİNLERİ VE KAR MARJI SONUÇLARI -->
            <div class="lg:col-span-1 space-y-4">

                <!-- Gelir Tahminleri -->
                <div class="card bg-blue-50 border-t-4 border-blue-600">
                    <h2 class="text-xl font-semibold text-blue-700 mb-2">2. Gelir Tahminleri</h2>

                    <div class="flex justify-between items-center mb-2 p-2 bg-blue-100 rounded-md">
                        <span class="font-medium text-blue-800 text-sm">Günlük Ciro</span>
                        <span id="dailyRevenueTotal" class="text-base font-bold text-blue-900">0 €</span>
                    </div>

                    <div class="pl-3 mb-2 space-y-1" id="dailyRevenueBreakdown">
                        <!-- JavaScript ile doldurulacak -->
                    </div>

                    <div class="flex justify-between items-center mb-2 p-2 bg-blue-100 rounded-md">
                        <span class="font-medium text-blue-800 text-sm">Aylık Ciro (30 Gün)</span>
                        <span id="monthlyRevenue" class="text-base font-bold text-blue-900">0 €</span>
                    </div>

                    <div class="flex justify-between items-center p-2 bg-blue-100 rounded-md">
                        <span class="font-medium text-blue-800 text-sm">Yıllık Ciro (365 Gün)</span>
                        <span id="annualRevenue" class="text-base font-bold text-blue-900">0 €</span>
                    </div>
                </div>

                <!-- Kar Marjı Sonuçları -->
                <div class="card bg-green-50 border-t-4 border-green-600">
                    <h2 class="text-xl font-semibold text-green-700 mb-2">3. Kâr Marjı Özeti</h2>

                    <div class="space-y-1" id="profitSummaryContainer"></div>

                    <div class="report-total" id="profitResultContainer"></div>

                    <p class="text-xs text-gray-500 mt-2">Kıyaslama: Hollanda Horeca Sektörü ortalamalarıdır.</p>
                </div>
            </div>

            <!-- DEĞERLEME & ROI -->
            <div class="lg:col-span-3 card border-t-4 border-yellow-500">
                <div class="accordion-header" onclick="toggleValuationAccordion()">
                    <h2 class="text-xl font-semibold text-yellow-700">4. İşletme Değerleme & ROI Analizi</h2>
                    <svg class="accordion-icon-valuation w-6 h-6 text-yellow-700" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>

                <div class="accordion-content" id="valuationContent">
                    <div class="pt-3">
                        <div class="mb-3">
                            <div class="flex items-center justify-between mb-1">
                                <label for="manualProfit" class="block text-sm font-medium text-gray-700">Aylık Net Kâr
                                    (€)</label>
                                <div class="flex items-center gap-2">
                                    <label class="flex items-center cursor-pointer text-xs">
                                        <input type="radio" name="profitMode" value="auto" checked
                                            class="h-3 w-3 text-yellow-600">
                                        <span class="ml-1">Otomatik</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer text-xs">
                                        <input type="radio" name="profitMode" value="manual"
                                            class="h-3 w-3 text-yellow-600">
                                        <span class="ml-1">Manuel</span>
                                    </label>
                                </div>
                            </div>
                            <input type="text" inputmode="decimal" id="manualProfit" value="0" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 disabled:bg-gray-100">
                            <p class="text-xs text-gray-500 mt-1">Otomatik: Yukarıdaki hesaplamalardan alınır. Manuel:
                                Kendi değerinizi girebilirsiniz.</p>
                        </div>

                        <!-- DCF Değerleme Tablosu -->
                        <div class="mt-3">
                            <h3 class="text-base font-semibold text-yellow-800 mb-2">Tahmini İşletme Değeri (Kâr
                                Katsayısı Metodu)</h3>
                            <table class="dcf-table">
                                <thead>
                                    <tr>
                                        <th>Çarpan</th>
                                        <th>Tahmini Değer (€)</th>
                                        <th>ROI (Ay)</th>
                                        <th>ROI (Yıl)</th>
                                    </tr>
                                </thead>
                                <tbody id="dcfTableBody">
                                    <!-- JavaScript ile doldurulacak -->
                                </tbody>
                            </table>
                            <p class="text-xs text-yellow-700 mt-2 mb-3">Bu değerler, yıllık net kârın belirtilen
                                katsayı ile çarpımıyla hesaplanmıştır. ROI, yatırımın aylık net kâr ile geri dönüş
                                süresini gösterir.</p>

                            <!-- Katsayı Açıklamaları -->
                            <div class="space-y-2 mt-3 text-xs">
                                <div class="p-2 bg-red-50 border-l-4 border-red-500 rounded">
                                    <span class="font-bold text-red-700">3x Katsayısı:</span>
                                    <span class="text-red-600"> Yüksek riskli, düşük büyüme potansiyeline sahip, sahibe
                                        çok bağımlı işletmeler için. Yatırımcı parayı 3 yılda geri ister.</span>
                                </div>

                                <div class="p-2 bg-blue-50 border-l-4 border-blue-500 rounded">
                                    <span class="font-bold text-blue-700">5x Katsayısı:</span>
                                    <span class="text-blue-600"> Ortalama risk/getiri beklentisi. Yatırımcı parayı ~5
                                        yılda geri almayı bekler. Makul sermaye geri dönüş süresi.</span>
                                </div>

                                <div class="p-2 bg-green-50 border-l-4 border-green-500 rounded">
                                    <span class="font-bold text-green-700">7x Katsayısı:</span>
                                    <span class="text-green-600"> Düşük riskli, istikrarlı, yüksek büyüme potansiyeli,
                                        sektör lideri işletmeler için. Yatırımcı uzun vadeli potansiyel için daha yüksek
                                        bedel öder.</span>
                                </div>

                                <p class="text-gray-500 italic pt-1">Özetle, 3x, 5x ve 7x gibi katsayılar, küçük işletme
                                    alım satımlarında pratik bir başlangıç aralığı oluşturmak için kullanılan yaygın
                                    kural-bazlı tahminlerdir.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ORTAKLIK PAYI (ACCORDION) -->
            <div class="lg:col-span-3 card border-t-4 border-purple-500">
                <div class="accordion-header" onclick="toggleAccordion()">
                    <h2 class="text-xl font-semibold text-purple-700">5. Ortaklık Payı Hesaplama</h2>
                    <svg class="accordion-icon w-6 h-6 text-purple-700" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>

                <div class="accordion-content" id="partnershipContent">
                    <div class="pt-3">
                        <div class="mb-3">
                            <label for="partnerCount" class="block text-sm font-medium text-gray-700 mb-1">Ortak
                                Sayısı</label>
                            <select id="partnerCount"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 transition duration-150">
                                <option value="1">1 (Tek Sahip)</option>
                                <option value="2" selected>2 Ortak</option>
                                <option value="3">3 Ortak</option>
                                <option value="4">4 Ortak</option>
                            </select>
                        </div>

                        <div id="partnerInputsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3"></div>

                        <div id="partnerTotalCheck"
                            class="text-sm font-medium p-2 rounded-md bg-yellow-100 text-yellow-800 hidden">
                            Toplam Hisse Oranı: <span id="partnerTotalPercent">0%</span>. Toplam %100 olmalıdır!
                        </div>

                        <div id="partnerResultsContainer" class="mt-4 space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="customModal" class="modal-overlay" onclick="closeModal(event)">
            <div class="modal-content">
                <h3 id="modalTitle" class="text-xl font-semibold text-gray-900 mb-4">Rapor Özeti</h3>
                <textarea id="modalTextarea" class="w-full h-48 p-2 border border-gray-300 rounded-md mb-4 text-sm"
                    readonly></textarea>
                <div class="flex justify-end space-x-3">
                    <button onclick="copyToClipboardAndClose();"
                        class="bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                        Panoya Kopyala
                    </button>
                    <button onclick="closeModalBtn();"
                        class="bg-gray-300 hover:bg-gray-400 active:bg-gray-500 text-gray-800 font-semibold py-2 px-4 rounded-lg transition duration-200">
                        Kapat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DAYS_IN_MONTH = 30;
        const DAYS_IN_YEAR = 365;

        const BENCHMARK = {
            foodCost: { min: 0.28, max: 0.33, avg: 0.30, label: '≈ %30 (28-33%)' },
            personnelCost: { min: 0.25, max: 0.35, avg: 0.30, label: '≈ %30 (25-35%)' },
            opEx: { min: 0.06, max: 0.10, avg: 0.08, label: '≈ %8 (6-10%)' },
            netProfit: { min: 0.10, max: 0.15, avg: 0.12, label: '≈ %10-15 (Ortalama %12)' }
        };

        const DEFAULT_DAILY_REVENUE = 0;
        const DEFAULT_FOOD_COST = 0;
        const DEFAULT_PERSONNEL_COST = 0;
        const DEFAULT_OPEX = 0;

        // Rakam Formatlama Fonksiyonu (Bin ayırıcı ile)
        function formatNumber(num) {
            if (!num && num !== 0) return '';
            const parts = num.toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            return parts.join(',');
        }

        function parseFormattedNumber(str) {
            if (!str) return 0;
            return parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
        }

        const currencyFormatter = new Intl.NumberFormat('tr-TR', {
            style: 'currency',
            currency: 'EUR',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0,
        });

        const percentFormatter = new Intl.NumberFormat('tr-TR', {
            style: 'percent',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
        });

        const numberFormatter = new Intl.NumberFormat('tr-TR', {
            minimumFractionDigits: 1,
            maximumFractionDigits: 1
        });

        // Input formatlama
        function setupNumberInput(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;

            input.addEventListener('blur', function () {
                const value = parseFormattedNumber(this.value);
                this.value = formatNumber(value);
            });

            input.addEventListener('focus', function () {
                const value = parseFormattedNumber(this.value);
                this.value = value > 0 ? value : '';
            });

            input.addEventListener('input', function () {
                calculateProfit();
            });
        }

        function createExpenseInput(id, label, defaultValue, defaultUnit) {
            return `
                <div class="mb-3 p-2 border border-gray-200 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">${label}</label>
                    <div class="input-group">
                        <input type="text" inputmode="decimal" id="${id}Value" value="${defaultValue}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">

                        <div class="flex space-x-4 text-sm font-medium text-gray-700">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="${id}Unit" value="percent" ${defaultUnit === 'percent' ? 'checked' : ''} class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <span class="ml-1">% (Ciroya Oran)</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="${id}Unit" value="amount" ${defaultUnit === 'amount' ? 'checked' : ''} class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <span class="ml-1">€ (Aylık Miktar)</span>
                            </label>
                        </div>
                    </div>
                </div>
            `;
        }

        function createReportRow(label, amount, percentage, benchmark, benchmarkData) {
            const pctFormatter = new Intl.NumberFormat('tr-TR', {
                style: 'percent', minimumFractionDigits: 2, maximumFractionDigits: 2,
            });
            const amtFormatter = new Intl.NumberFormat('tr-TR', {
                style: 'currency', currency: 'EUR', minimumFractionDigits: 0, maximumFractionDigits: 0,
            });

            // Benchmark kontrolü - max değerden yüksekse kırmızı
            const isOverBenchmark = percentage > benchmarkData.max;
            const textColor = isOverBenchmark ? 'text-red-600 font-bold' : 'text-gray-800';

            return `
                <div class="report-item">
                    <span class="text-gray-600 text-sm">${label}</span>
                    <span class="${textColor} text-sm">${amtFormatter.format(amount)} (${pctFormatter.format(percentage)})</span>
                </div>
                <div class="benchmark-item">
                    Kıyaslama (NL): ${benchmark}
                </div>
            `;
        }

        function calculateProfit() {
            // Üç farklı ciro kaynağı
            const cashRevenue = parseFormattedNumber(document.getElementById('cashRevenue').value) || 0;
            const cardRevenue = parseFormattedNumber(document.getElementById('cardRevenue').value) || 0;
            const deliveryRevenue = parseFormattedNumber(document.getElementById('deliveryRevenue').value) || 0;
            const deliveryCommission = parseFormattedNumber(document.getElementById('deliveryCommission').value) || 0;

            // Toplam günlük ciro
            const dailyRevenue = cashRevenue + cardRevenue + deliveryRevenue;

            // Evlere servis gider hesaplaması
            const deliveryExpense = deliveryRevenue * (deliveryCommission / 100);
            const deliveryToPersonnel = deliveryExpense * 0.80; // %80'i personele
            const deliveryToFood = deliveryExpense * 0.20; // %20'si gıdaya

            const foodCostValue = parseFormattedNumber(document.getElementById('foodCostValue')?.value) || 0;
            const foodCostUnit = document.querySelector('input[name="foodCostUnit"]:checked')?.value || 'percent';

            const personnelCostValue = parseFormattedNumber(document.getElementById('personnelCostValue')?.value) || 0;
            const personnelCostUnit = document.querySelector('input[name="personnelCostUnit"]:checked')?.value || 'percent';

            const opExValue = parseFormattedNumber(document.getElementById('opExValue')?.value) || 0;
            const opExUnit = document.querySelector('input[name="opExUnit"]:checked')?.value || 'percent';

            const monthlyRevenue = dailyRevenue * DAYS_IN_MONTH;
            const annualRevenue = dailyRevenue * DAYS_IN_YEAR;

            document.getElementById('dailyRevenueTotal').textContent = currencyFormatter.format(dailyRevenue);
            document.getElementById('monthlyRevenue').textContent = currencyFormatter.format(monthlyRevenue);
            document.getElementById('annualRevenue').textContent = currencyFormatter.format(annualRevenue);

            // Günlük ciro dağılımını göster
            const dailyBreakdownContainer = document.getElementById('dailyRevenueBreakdown');
            let breakdownHTML = '';

            if (dailyRevenue > 0) {
                const cashPercent = (cashRevenue / dailyRevenue) * 100;
                const cardPercent = (cardRevenue / dailyRevenue) * 100;
                const deliveryPercent = (deliveryRevenue / dailyRevenue) * 100;

                if (cashRevenue > 0) {
                    breakdownHTML += `<div class="text-xs text-blue-700">• Nakit: ${currencyFormatter.format(cashRevenue)} (${cashPercent.toFixed(1)}%)</div>`;
                }
                if (cardRevenue > 0) {
                    breakdownHTML += `<div class="text-xs text-blue-700">• Peşin Ödemeler: ${currencyFormatter.format(cardRevenue)} (${cardPercent.toFixed(1)}%)</div>`;
                }
                if (deliveryRevenue > 0) {
                    breakdownHTML += `<div class="text-xs text-blue-700">• Evlere Servis: ${currencyFormatter.format(deliveryRevenue)} (${deliveryPercent.toFixed(1)}%)</div>`;
                }
            }

            dailyBreakdownContainer.innerHTML = breakdownHTML;

            // Gider hesaplamaları (evlere servis giderleri dahil)
            let monthlyFoodCost = foodCostUnit === 'percent' ? monthlyRevenue * (foodCostValue / 100) : foodCostValue;
            let monthlyPersonnelCost = personnelCostUnit === 'percent' ? monthlyRevenue * (personnelCostValue / 100) : personnelCostValue;
            let monthlyOpEx = opExUnit === 'percent' ? monthlyRevenue * (opExValue / 100) : opExValue;

            // Evlere servis giderlerini ekle
            const monthlyDeliveryToFood = (deliveryRevenue * DAYS_IN_MONTH) * (deliveryCommission / 100) * 0.20;
            const monthlyDeliveryToPersonnel = (deliveryRevenue * DAYS_IN_MONTH) * (deliveryCommission / 100) * 0.80;

            monthlyFoodCost += monthlyDeliveryToFood;
            monthlyPersonnelCost += monthlyDeliveryToPersonnel;

            if (monthlyRevenue === 0) {
                if (foodCostUnit === 'percent') monthlyFoodCost = 0;
                if (personnelCostUnit === 'percent') monthlyPersonnelCost = 0;
                if (opExUnit === 'percent') monthlyOpEx = 0;
            }

            const totalMonthlyExpenses = monthlyFoodCost + monthlyPersonnelCost + monthlyOpEx;
            const monthlyNetProfitAmount = monthlyRevenue - totalMonthlyExpenses;

            const annualNetProfit = monthlyNetProfitAmount * 12;

            let netProfitMarginPercent = monthlyRevenue > 0 ? monthlyNetProfitAmount / monthlyRevenue : 0;

            const summaryContainer = document.getElementById('profitSummaryContainer');
            const profitResultContainer = document.getElementById('profitResultContainer');

            const foodCostPercent = monthlyRevenue > 0 ? monthlyFoodCost / monthlyRevenue : 0;
            const personnelCostPercent = monthlyRevenue > 0 ? monthlyPersonnelCost / monthlyRevenue : 0;
            const opExPercent = monthlyRevenue > 0 ? monthlyOpEx / monthlyRevenue : 0;

            let summaryHTML = '';

            summaryHTML += createReportRow(
                "1. Sabit Giderler",
                monthlyOpEx,
                opExPercent,
                BENCHMARK.opEx.label,
                BENCHMARK.opEx
            );

            summaryHTML += createReportRow(
                "2. Gıda ve Paketleme",
                monthlyFoodCost,
                foodCostPercent,
                BENCHMARK.foodCost.label,
                BENCHMARK.foodCost
            );

            summaryHTML += createReportRow(
                "3. Personel Giderleri",
                monthlyPersonnelCost,
                personnelCostPercent,
                BENCHMARK.personnelCost.label,
                BENCHMARK.personnelCost
            );

            summaryContainer.innerHTML = summaryHTML;

            const profitAmountText = currencyFormatter.format(monthlyNetProfitAmount);
            const profitPercentText = percentFormatter.format(netProfitMarginPercent);

            const isLoss = monthlyNetProfitAmount < 0;
            const profitClass = isLoss ? 'text-red-600' : 'text-green-900';
            const bgClass = isLoss ? 'bg-red-50 border-red-600' : 'bg-green-50 border-green-600';

            profitResultContainer.className = `report-total border-t-4 ${bgClass}`;

            profitResultContainer.innerHTML = `
                <div class="report-item border-none pt-0 pb-0">
                    <span class="block text-sm font-medium text-green-800">Aylık Net Kâr (€)</span>
                    <span id="monthlyNetProfitAmountDisplay" class="text-xl font-extrabold ${profitClass}">${profitAmountText}</span>
                </div>
                <div class="report-item border-none pt-0 pb-0 mt-1">
                    <span class="block text-sm font-medium text-green-800">Net Kâr Marjı (%)</span>
                    <span id="netProfitMarginPercentDisplay" class="text-xl font-extrabold ${profitClass}">${profitPercentText}</span>
                </div>
                <div class="annual-revenue-line">
                    Yıllık Net Kâr: ${currencyFormatter.format(annualNetProfit)}
                </div>
                <div class="benchmark-item !text-xs !text-gray-500 !mt-1 !text-left">
                    Kıyaslama Net Kâr (NL): ${BENCHMARK.netProfit.label}
                </div>
                <input type="hidden" id="annualNetProfit" value="${annualNetProfit.toFixed(2)}">
                <input type="hidden" id="monthlyNetProfit" value="${monthlyNetProfitAmount.toFixed(2)}">
            `;

            // Otomatik modda manuel input'u güncelle
            const profitMode = document.querySelector('input[name="profitMode"]:checked')?.value;
            if (profitMode === 'auto') {
                document.getElementById('manualProfit').value = formatNumber(monthlyNetProfitAmount.toFixed(2));
            }

            calculatePartnership();
            calculateDCF();
        }

        function calculatePartnership() {
            const profitMode = document.querySelector('input[name="profitMode"]:checked')?.value;
            let monthlyNetProfitAmount = 0;

            if (profitMode === 'manual') {
                monthlyNetProfitAmount = parseFormattedNumber(document.getElementById('manualProfit')?.value) || 0;
            } else {
                monthlyNetProfitAmount = parseFloat(document.getElementById('monthlyNetProfit')?.value) || 0;
            }

            const partnerCount = parseInt(document.getElementById('partnerCount').value);
            const resultsContainer = document.getElementById('partnerResultsContainer');
            const checkElement = document.getElementById('partnerTotalCheck');
            const totalPercentElement = document.getElementById('partnerTotalPercent');

            resultsContainer.innerHTML = '';

            if (partnerCount <= 1) {
                const ownerProfitClass = monthlyNetProfitAmount < 0 ? 'text-red-600' : 'text-purple-900';
                resultsContainer.innerHTML = `
                    <div class="p-3 bg-purple-100 border-l-4 border-purple-700 rounded-md">
                        <p class="text-base text-purple-700 font-semibold">Tek Sahip. Tüm Kâr ( <span class="font-extrabold ${ownerProfitClass}">${currencyFormatter.format(monthlyNetProfitAmount)}</span> ) size aittir.</p>
                    </div>
                `;
            } else {
                let totalShare = 0;
                let partnerShares = [];

                for (let i = 1; i <= partnerCount; i++) {
                    const shareInput = document.getElementById(`partnerShare${i}`);
                    const sharePercent = parseFormattedNumber(shareInput?.value) || 0;
                    totalShare += sharePercent;

                    const partnerProfit = monthlyNetProfitAmount * (sharePercent / 100);

                    partnerShares.push({
                        id: i,
                        percent: sharePercent,
                        profit: partnerProfit
                    });
                }

                totalPercentElement.textContent = `${totalShare.toFixed(2)}%`;
                if (Math.abs(totalShare - 100) > 0.01) {
                    checkElement.classList.remove('hidden', 'bg-green-100', 'text-green-800');
                    checkElement.classList.add('bg-yellow-100', 'text-yellow-800');
                } else {
                    checkElement.classList.remove('hidden', 'bg-yellow-100', 'text-yellow-800');
                    checkElement.classList.add('bg-green-100', 'text-green-800');
                }

                partnerShares.forEach(p => {
                    const isLoss = p.profit < 0;
                    const profitClass = isLoss ? 'text-red-600' : 'text-purple-900';

                    resultsContainer.innerHTML += `
                        <div class="p-2 border-2 rounded-md flex justify-between items-center partner-${p.id}">
                            <span class="text-sm font-semibold text-gray-700">Ortak ${p.id} (${p.percent.toFixed(2)}%)</span>
                            <span class="text-base font-bold ${profitClass}">${currencyFormatter.format(p.profit)}</span>
                        </div>
                    `;
                });
            }
        }

        function setupPartnerInputs() {
            const partnerCount = parseInt(document.getElementById('partnerCount').value);
            const container = document.getElementById('partnerInputsContainer');
            container.innerHTML = '';

            if (partnerCount <= 1) {
                document.getElementById('partnerTotalCheck').classList.add('hidden');
            } else {
                document.getElementById('partnerTotalCheck').classList.remove('hidden');

                const defaultShare = 0;

                for (let i = 1; i <= partnerCount; i++) {
                    const inputHtml = `
                        <div class="flex items-center space-x-2 w-full">
                            <label for="partnerShare${i}" class="text-sm font-medium text-gray-700 flex-shrink-0">Ortak ${i} (%)</label>
                            <input type="text" inputmode="decimal" id="partnerShare${i}" value="${defaultShare}"
                                   class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 text-right">
                            <span class="text-gray-500 flex-shrink-0">%</span>
                        </div>
                    `;
                    container.innerHTML += inputHtml;
                }

                for (let i = 1; i <= partnerCount; i++) {
                    setupNumberInput(`partnerShare${i}`);
                }
            }
            calculatePartnership();
        }

        function calculateDCF() {
            const profitMode = document.querySelector('input[name="profitMode"]:checked')?.value;
            let monthlyNetProfit = 0;

            if (profitMode === 'manual') {
                monthlyNetProfit = parseFormattedNumber(document.getElementById('manualProfit')?.value) || 0;
            } else {
                monthlyNetProfit = parseFloat(document.getElementById('monthlyNetProfit')?.value) || 0;
            }

            const annualNetProfit = monthlyNetProfit * 12;

            const tableBody = document.getElementById('dcfTableBody');
            tableBody.innerHTML = '';

            const multipliers = [2, 3, 4, 5];

            multipliers.forEach(multiplier => {
                const estimatedValue = annualNetProfit * multiplier;

                let roiMonths = 0;
                let roiYears = 0;

                if (monthlyNetProfit > 0) {
                    roiMonths = estimatedValue / monthlyNetProfit;
                    roiYears = roiMonths / 12;
                }

                const row = `
                    <tr>
                        <td class="font-semibold">${multiplier}x</td>
                        <td class="font-bold text-yellow-800">${currencyFormatter.format(estimatedValue)}</td>
                        <td>${monthlyNetProfit > 0 ? numberFormatter.format(roiMonths) : '-'}</td>
                        <td>${monthlyNetProfit > 0 ? numberFormatter.format(roiYears) : '-'}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        function toggleAccordion() {
            const content = document.getElementById('partnershipContent');
            const icon = document.querySelector('.accordion-icon');

            content.classList.toggle('active');
            icon.classList.toggle('active');
        }

        function toggleValuationAccordion() {
            const content = document.getElementById('valuationContent');
            const icon = document.querySelector('.accordion-icon-valuation');

            content.classList.toggle('active');
            icon.classList.toggle('active');
        }

        function toggleProfitMode() {
            const profitMode = document.querySelector('input[name="profitMode"]:checked')?.value;
            const manualInput = document.getElementById('manualProfit');

            if (profitMode === 'manual') {
                manualInput.disabled = false;
                manualInput.classList.remove('disabled:bg-gray-100');
            } else {
                manualInput.disabled = true;
                manualInput.classList.add('disabled:bg-gray-100');
                const autoProfit = parseFloat(document.getElementById('monthlyNetProfit')?.value) || 0;
                manualInput.value = formatNumber(autoProfit.toFixed(2));
            }

            calculateDCF();
            calculatePartnership();
        }

        function clearInputs() {
            document.getElementById('cashRevenue').value = '0';
            document.getElementById('cardRevenue').value = '0';
            document.getElementById('deliveryRevenue').value = '0';
            document.getElementById('deliveryCommission').value = '0';

            document.getElementById('foodCostValue').value = '0';
            document.querySelector('input[name="foodCostUnit"][value="percent"]').checked = true;

            document.getElementById('personnelCostValue').value = '0';
            document.querySelector('input[name="personnelCostUnit"][value="percent"]').checked = true;

            document.getElementById('opExValue').value = '0';
            document.querySelector('input[name="opExUnit"][value="percent"]').checked = true;

            document.getElementById('manualProfit').value = '0';
            document.querySelector('input[name="profitMode"][value="auto"]').checked = true;
            toggleProfitMode();

            document.getElementById('partnerCount').value = 2;
            setupPartnerInputs();

            calculateProfit();
            calculateDCF();

            showModal('Girdiler Sıfırlandı', 'Tüm giriş alanları başarıyla temizlendi ve sıfırlandı.', false);
        }

        function generateAndShowReport() {
            calculateProfit();

            const cashRevenue = parseFormattedNumber(document.getElementById('cashRevenue').value) || 0;
            const cardRevenue = parseFormattedNumber(document.getElementById('cardRevenue').value) || 0;
            const deliveryRevenue = parseFormattedNumber(document.getElementById('deliveryRevenue').value) || 0;
            const dailyRevenue = cashRevenue + cardRevenue + deliveryRevenue;

            const monthlyRevenue = dailyRevenue * DAYS_IN_MONTH;
            const annualRevenue = dailyRevenue * DAYS_IN_YEAR;

            const profitMode = document.querySelector('input[name="profitMode"]:checked')?.value;
            let monthlyNetProfit = 0;

            if (profitMode === 'manual') {
                monthlyNetProfit = parseFormattedNumber(document.getElementById('manualProfit')?.value) || 0;
            } else {
                monthlyNetProfit = parseFloat(document.getElementById('monthlyNetProfit')?.value) || 0;
            }

            const annualNetProfit = monthlyNetProfit * 12;
            const netProfitMarginPercent = monthlyRevenue > 0 ? monthlyNetProfit / monthlyRevenue : 0;

            let report = "--- HORECA FİNANSAL ANALİZ VE DEĞERLEME RAPORU ---\n\n";
            report += `Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}\n`;
            report += `------------------------------------------------------\n`;
            report += `1. TEMEL FİNANSAL ANALİZ\n`;
            report += `   - Günlük Ortalama Ciro: ${currencyFormatter.format(dailyRevenue)}\n`;
            report += `     • Nakit: ${currencyFormatter.format(cashRevenue)}\n`;
            report += `     • Peşin Ödemeler: ${currencyFormatter.format(cardRevenue)}\n`;
            report += `     • Evlere Servis: ${currencyFormatter.format(deliveryRevenue)}\n`;
            report += `   - Aylık Ciro Tahmini: ${currencyFormatter.format(monthlyRevenue)}\n`;
            report += `   - Yıllık Ciro Tahmini: ${currencyFormatter.format(annualRevenue)}\n`;
            report += `   - Aylık Net Kâr: ${currencyFormatter.format(monthlyNetProfit)}\n`;
            report += `   - Yıllık Net Kâr: ${currencyFormatter.format(annualNetProfit)}\n`;
            report += `   - Net Kâr Marjı: ${percentFormatter.format(netProfitMarginPercent)}\n`;
            report += `\n`;
            report += `2. HOLLANDA HORECA KIYASLAMA (Ortalama)\n`;
            report += `   - Net Kâr Marjı Hedefi: ${BENCHMARK.netProfit.label}\n`;
            report += `\n`;
            report += `------------------------------------------------------\n`;
            report += `3. İŞLETME DEĞERLEME (KÂR KATSAYISI METODU)\n`;
            report += `   - Yıllık Net Kâr: ${currencyFormatter.format(annualNetProfit)}\n\n`;

            const multipliers = [2, 3, 4, 5];
            multipliers.forEach(mult => {
                const value = annualNetProfit * mult;
                const roiMonths = monthlyNetProfit > 0 ? value / monthlyNetProfit : 0;
                const roiYears = roiMonths / 12;
                report += `   ${mult}x Çarpan:\n`;
                report += `     - Tahmini Değer: ${currencyFormatter.format(value)}\n`;
                report += `     - ROI: ${numberFormatter.format(roiMonths)} Ay / ${numberFormatter.format(roiYears)} Yıl\n\n`;
            });

            report += `------------------------------------------------------\n`;

            showModal('Finansal Rapor Özeti', report, true);
        }

        function showModal(title, content, isTextarea) {
            document.getElementById('modalTitle').textContent = title;
            const textarea = document.getElementById('modalTextarea');
            const modal = document.getElementById('customModal');

            textarea.value = content;
            textarea.readOnly = !isTextarea;

            document.querySelector('.modal-content button:first-child').style.display = isTextarea ? 'inline-flex' : 'none';

            modal.style.display = 'flex';
        }

        function closeModal(event) {
            if (event.target.id === 'customModal') {
                document.getElementById('customModal').style.display = 'none';
            }
        }

        function closeModalBtn() {
            document.getElementById('customModal').style.display = 'none';
        }

        function copyToClipboardAndClose() {
            const textarea = document.getElementById('modalTextarea');
            textarea.select();
            textarea.setSelectionRange(0, 99999);

            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'Panoya kopyalandı!' : 'Kopyalama başarısız.';

                document.getElementById('modalTitle').textContent = 'Kopyalama Başarılı!';
                document.getElementById('modalTextarea').value = msg;

            } catch (err) {
                console.error('Kopyalama hatası:', err);
                document.getElementById('modalTextarea').value = 'Hata: Tarayıcı kopyalamayı desteklemiyor.';
            }

            setTimeout(() => {
                document.getElementById('customModal').style.display = 'none';
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const expenseContainer = document.getElementById('expense-container');
            expenseContainer.innerHTML = [
                createExpenseInput('foodCost', 'Gıda ve Paketleme Maliyeti (Food Cost)', DEFAULT_FOOD_COST, 'percent'),
                createExpenseInput('personnelCost', 'Personel Giderleri', DEFAULT_PERSONNEL_COST, 'percent'),
                createExpenseInput('opEx', 'Sabit Giderler (Kira, Enerji vb.)', DEFAULT_OPEX, 'percent')
            ].join('');

            setupNumberInput('cashRevenue');
            setupNumberInput('cardRevenue');
            setupNumberInput('deliveryRevenue');
            setupNumberInput('deliveryCommission');
            setupNumberInput('manualProfit');
            setupNumberInput('foodCostValue');
            setupNumberInput('personnelCostValue');
            setupNumberInput('opExValue');

            document.getElementById('partnerCount').addEventListener('change', setupPartnerInputs);

            document.querySelectorAll('input[name="profitMode"]').forEach(radio => {
                radio.addEventListener('change', toggleProfitMode);
            });

            ['foodCost', 'personnelCost', 'opEx'].forEach(expenseId => {
                document.querySelectorAll(`input[name="${expenseId}Unit"]`).forEach(radio => {
                    radio.addEventListener('change', calculateProfit);
                });
            });

            setupPartnerInputs();
            toggleProfitMode();
            calculateProfit();
            calculateDCF();
        });
    </script>
</body>

</html>